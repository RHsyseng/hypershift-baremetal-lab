= Preparing the lab
include::_attributes.adoc[]
:profile: telco-hypershift-baremetal-lab

**NOTE:** This section can be skipped if lab has been prepared for you.

[#prepare-hypervisor]
== Prepare the hypervisor

**NOTE:** If you want to deploy on something else than local libvirt, refer to Kcli documentation

We install and launch libvirt

```
sudo dnf -y install libvirt libvirt-daemon-driver-qemu qemu-kvm
systemctl enable --now libvirtd
```

[#get-kcli]
== Get Kcli

We will leverage [Kcli](https://kcli.readthedocs.io/en/latest) to easily create the assets needed for the lab.

Install it with the following instructions:

```
sudo dnf -y copr enable karmab/kcli
sudo dnf -y install kcli
```

[#create-baremetal-like-vms]
== Create baremetal-like vms

* Launch the following command:

```
kcli create vm -P uefi=true -P start=false -P memory=20480 -P numcpus=16 -P disks=['{"size": 200, "interface": "sata"}'] -P nets=['{"name": "default", "mac": "aa:aa:aa:bb:bb:90"}'] -c 3 -P plan=lab-vms lab
```

Expected Output

```
Deploying vm lab-0 from profile kvirt...
lab-0 created on local
Deploying vm lab-1 from profile kvirt...
lab-1 created on local
Deploying vm lab-2 from profile kvirt...
lab-2 created on local
```

This will deploy 3 empty ctlplane vms to emulate bare metal nodes.

* Check the created vms

```
kcli list vm
```

Expected Output

```
+------------------------+--------+-----------------+------------------------------------------------------+---------------+---------+
|          Name          | Status |        Ip       |                        Source                        |      Plan     | Profile |
+------------------------+--------+-----------------+------------------------------------------------------+---------------+---------+
|         lab-0          |  down  |                 |                                                      |      lab      |  kvirt  |
|         lab-1          |  down  |                 |                                                      |      lab      |  kvirt  |
|         lab-2          |  down  |                 |                                                      |      lab      |  kvirt  |
+------------------------+--------+-----------------+------------------------------------------------------+---------------+---------+
```
